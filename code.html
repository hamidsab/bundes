<!DOCTYPE html>
<html>
  <head>
    <title>Bus APP</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      html, body, #content {
        height: 100%;
        margin: 2px;
        padding: 10px;
        font-family: Helvetica;
        font-size:medium;
        
      }
    </style>
    <!--
    Include the maps javascript with sensor=true because this code is using a
    sensor (a GPS locator) to determine the user's location.
    Also include Jquery if you need it 
    -->
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true"></script>
    <script>
    //variables declaration 
    var positionMe;
    var loc1toMe;
    var loc2toMe;
    //the caculationg function
    //ignore the yellow lines they are because of spacing, its working perfectly
    google.maps.LatLng.prototype.distanceFrom = function(latlng) {
	  		var lat = [this.lat(), latlng.lat()];
	  		var lng = [this.lng(), latlng.lng()];
	  		var R = 6378137;
	  		var dLat = (lat[1]-lat[0]) * Math.PI / 180;
	  		var dLng = (lng[1]-lng[0]) * Math.PI / 180;
	  		var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
	  		Math.cos(lat[0] * Math.PI / 180 ) * Math.cos(lat[1] * Math.PI / 180 ) *
	  		Math.sin(dLng/2) * Math.sin(dLng/2);
	  		var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
	  		var d = R * c;
	  		return Math.round(d);
			}
			//Get the coordinate of your busStop from google or openstreet			
			var location_1 = new google.maps.LatLng(50.98167,11.325238); //Goetheplatz
			var location_2 = new google.maps.LatLng(50.974994,11.329585);//Bauhaus uni
			var location_3 = new google.maps.LatLng(50.977348, 11.326633);//Wielandplatz
			var location_4 = new google.maps.LatLng(50.978784, 11.324432);//Gropiustrasse
			var location_5 = new google.maps.LatLng(50.984601, 11.329168);//Atrium
			var location_6 = new google.maps.LatLng(50.988744, 11.329841);//Meyerstr
			var location_7 = new google.maps.LatLng(50.990974, 11.329477);//Schopenhauerstr
			var location_8 = new google.maps.LatLng(50.991111, 11.325663);//Hauptbahnhof    50.991111, 11.325626
			var location_9 = new google.maps.LatLng(50.987214, 11.326495);//Carl August allee
			var location_10 = new google.maps.LatLng(50.988890, 11.322682);//Ernst Thaelmann strasse/Meyerstr
			var location_11 = new google.maps.LatLng(50.987287, 11.323883);//Ernst Thaelmann strasse
			var location_12 = new google.maps.LatLng(50.974828, 11.327127);//Am Posechsen Garten
			var location_13 = new google.maps.LatLng(50.971634, 11.326292);//Karl Hausknesct str
			var location_14 = new google.maps.LatLng(50.968371, 11.323739);//Friedhof
			var location_15 = new google.maps.LatLng(50.960344, 11.319065);//Zum Hospital Graben
			var location_16 = new google.maps.LatLng(50.961806, 11.321380);//Klinikum
			var location_17 = new google.maps.LatLng(50.962417, 11.326546);//Merketal
			var location_18 = new google.maps.LatLng(50.966235, 11.328535);//Wilder Graben
			var location_19 = new google.maps.LatLng(50.968108, 11.328655);//Rosenweg
			var location_20 = new google.maps.LatLng(50.971033, 11.328264);//Rainer-Maria-Rilke-Str
			var location_21 = new google.maps.LatLng(50.972461, 11.327856);//Rudolf-Breitscheid-Str
			var location_22 = new google.maps.LatLng(50.972554, 11.332024);//Berkaer Str
			var location_23 = new google.maps.LatLng(50.968960, 11.335492);//Helmholtzstr
			var location_24 = new google.maps.LatLng(50.966085, 11.338280);//Falkenburg
			var location_25 = new google.maps.LatLng(50.981334, 11.337504);//Hellerweg
			//var location_26 = new google.maps.LatLng(50.974847, 11.327121);//Am Posechsen Garten
			
// Note: This script requires that you consent to location sharing when the app load
function getcoords() {
coords = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);


function initialize() {
  // Try HTML5 geolocation
  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      positionMe = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
      //positionMe = new google.maps.LatLng(50.981481, 11.337173);
      //calculate user distnace from 1st bustop .... do this for all bustop
       loc1toMe = location_1.distanceFrom(positionMe);
	   loc2toMe = location_2.distanceFrom(positionMe);
	   loc3toMe = location_3.distanceFrom(positionMe);
	   loc4toMe = location_4.distanceFrom(positionMe);
	   loc5toMe = location_5.distanceFrom(positionMe);
	   loc6toMe = location_6.distanceFrom(positionMe);
	   loc7toMe = location_7.distanceFrom(positionMe);
	   loc8toMe = location_1.distanceFrom(positionMe);
	   loc9toMe = location_9.distanceFrom(positionMe);
	   loc10toMe = location_10.distanceFrom(positionMe);
	   loc11toMe = location_11.distanceFrom(positionMe);
	   loc12toMe = location_12.distanceFrom(positionMe);
	   loc13toMe = location_13.distanceFrom(positionMe);
	   loc14toMe = location_14.distanceFrom(positionMe);
	   loc15toMe = location_15.distanceFrom(positionMe);
	   loc16toMe = location_16.distanceFrom(positionMe);
	   loc17toMe = location_17.distanceFrom(positionMe);
	   loc18toMe = location_18.distanceFrom(positionMe);
	   loc19toMe = location_19.distanceFrom(positionMe);
	   loc20toMe = location_20.distanceFrom(positionMe);
	   loc21toMe = location_21.distanceFrom(positionMe);
	   loc22toMe = location_22.distanceFrom(positionMe);
	   loc23toMe = location_23.distanceFrom(positionMe);
	   loc24toMe = location_24.distanceFrom(positionMe);		
	   loc25toMe = location_25.distanceFrom(positionMe);	
       // for explnation only, I write the result on the page, you probably dont need it in your app
       $("#content").append("<p> "+loc1toMe + " meters to Hauptbahnhof");
  	   //loc2toMe = location_20.distanceFrom(positionMe);
  	   $("#content").append("<p>  "+loc2toMe + " meters to Falkenburg");
  	   //console.log just for debugging in console, if you dont need delete
  		console.log(loc1toMe);
  		console.log(loc2toMe);
  		console.log(loc3toMe);
  		console.log(loc4toMe);
  		console.log(loc5toMe);
  		console.log(loc6toMe);
  		console.log(loc7toMe);
  		console.log(loc8toMe);
  		console.log(loc9toMe);
  		console.log(loc10toMe);
  		console.log(loc11toMe);
  		console.log(loc12toMe);
  		console.log(loc13toMe);
  		console.log(loc14toMe);
  		console.log(loc15toMe);
  		console.log(loc16toMe);
  		console.log(loc17toMe);
  		console.log(loc18toMe);
  		console.log(loc19toMe);
  		console.log(loc20toMe);
  		console.log(loc21toMe);
  		console.log(loc22toMe);
  		console.log(loc23toMe);
  		console.log(loc25toMe);
  		
  		// next step, find the shortest of all the calcualted distance, seperate all distance with coma
  		var nearest =Math.min(loc1toMe,loc2toMe,loc3toMe,loc4toMe,loc5toMe,loc6toMe,loc7toMe,loc8toMe,
  			loc9toMe,loc10toMe,loc11toMe,loc12toMe,loc13toMe,loc14toMe,loc15toMe,loc16toMe,loc17toMe,loc2toMe,
  			loc18toMe,loc19toMe,loc20toMe,loc21toMe,loc22toMe,loc23toMe,loc24toMe,loc25toMe);
  		console.log(nearest);
  		//if statement to see which was the shortest
  		if (nearest=== loc1toMe){
  			//what ever you want to do here
  			// for explanation , I just write it to the page
  			$("#content").append("<p>  Your nearest Bustop is Goetheplatz");
  		}
  		else if (nearest == loc2toMe){
  			$("#content").append("<p> Your nearest Bustop is Bauhaus Uni");
  		}
  		else if (nearest === loc3toMe){
  			$("#content").append("<p> Your nearest Bustop is Wielandplatz");
  		}
  		else if (nearest === loc4toMe){
  			$("#content").append("<p> Your nearest Bustop is Gropiustrasse");
  		}
  		else if (nearest === loc5toMe){
  			$("#content").append("<p> Your nearest Bustop is Atrium");
  		}
  		else if (nearest === loc6toMe){
  			$("#content").append("<p> Your nearest Bustop is Meyerstr");
  		}
  		else if (nearest === loc7toMe){
  			$("#content").append("<p> Your nearest Bustop is Schopenhauerstr");
  		}
  		else if (nearest === loc8toMe){
  			$("#content").append("<p> Your nearest Bustop is Hauptbahnhof");
  		}
  		else if (nearest === loc9toMe){
  			$("#content").append("<p> Your nearest Bustop is Carl August allee");
  		}
  		else if (nearest=== loc10toMe){
  			$("#content").append("<p> Your nearest Bustop is Ernst Thaelmann strasse/Meyerstr");
  		}
  		else if (nearest === loc11toMe){
  			$("#content").append("<p> Your nearest Bustop is Ernst Thaelmann strasse");
  		}
  		else if (nearest === loc12toMe){
  			$("#content").append("<p> Your nearest Bustop is Am Posechsen Garten");
  		}
  		else if (nearest === loc13toMe){
  			$("#content").append("<p> Your nearest Bustop is Karl Hausknect str");
  		}
  		else if (nearest === loc14toMe){
  			$("#content").append("<p> Your nearest Bustop is Friedhof");
  		}
  		else if (nearest === loc15toMe){
  			$("#content").append("<p> Your nearest Bustop is Zum Hospital Graben");
  		}
  		else if (nearest === loc16toMe){
  			$("#content").append("<p> Your nearest Bustop is Klinikum");
  		}
  		else if (nearest === loc17toMe){
  			$("#content").append("<p> Your nearest Bustop is Merketal");
  		}
  		else if (nearest === loc18toMe){
  			$("#content").append("<p> Your nearest Bustop is Wilder Graben");
  		}
  		else if (nearest === loc19toMe){
  			$("#content").append("<p> Your nearest Bustop is Rosenweg");
  		}
  		else if (nearest === loc20toMe){
  			$("#content").append("<p> Your nearest Bustop is Rainer-Maria-Rilke-Str");
  		}
  		else if (nearest === loc21toMe){
  			$("#content").append("<p> Your nearest Bustop is Rudolf-Breitscheid-Str");
  		}
  		else if (nearest === loc22toMe){
  			$("#content").append("<p> Your nearest Bustop is Berkaer Str");
  		}
  		else if (nearest === loc23toMe){
  			$("#content").append("<p> Your nearest Bustop is Helmholtzstr");
  		}
  		else if (nearest === loc24toMe){
  			$("#content").append("<p> Your nearest Bustop is Falkenburg");
  		}
  		else if (nearest === loc25toMe){
  			$("#content").append("<p> Your nearest Bustop is Hellerweg");
  		}
  		//else if (nearest === loc26toMe){
  			//$("#content").append("<p> Your nearest Bustop is bus stop 26");
  		}
    });
   
  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }
  
}
// and here is the error function
function handleNoGeolocation(errorFlag) {
  if (errorFlag) {
  	$("#content").html("Geo location service failed");
  } else {
  	$("#content").html("Error: Your browser does not support geolocation.");
  }
}
//When user lunch the app, immediately get his/her position and find the nearest bustop
google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
    <div id="content">BlaBlabla</div>
  </body>
</html>